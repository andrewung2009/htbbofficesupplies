<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Supplies Management System</title>
    <link rel="icon" type="image/png" href="htbblogo.jpg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom Styles -->
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #06ffa5;
            --danger-color: #ff006e;
            --warning-color: #ffbe0b;
            --light-bg: #f8f9fa;
            --dark-text: #212529;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: var(--dark-text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Logo Styles */
        .logo {
            display: inline-block;
            vertical-align: middle;
        }

        .landing-title .logo {
            height: 60px;
            margin-right: 15px;
        }

        /* Landing Screen Styles */
        .landing-screen {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .landing-content {
            text-align: center;
            color: white;
            z-index: 2;
            max-width: 800px;
            width: 100%;
        }

        .landing-title {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            animation: fadeInUp 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }

        .landing-subtitle {
            font-size: 1.25rem;
            margin-bottom: 3rem;
            opacity: 0.9;
            animation: fadeInUp 0.8s ease 0.2s both;
        }

        .choice-buttons {
            display: flex;
            gap: 2rem;
            justify-content: center;
            flex-wrap: wrap;
            animation: fadeInUp 0.8s ease 0.4s both;
        }

        .choice-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2.5rem;
            width: 300px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .choice-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .choice-icon {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            color: white;
        }

        .choice-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        /* Floating shapes for decoration */
        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 20s infinite ease-in-out;
        }

        .shape-1 {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: white;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape-2 {
            width: 150px;
            height: 150px;
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            background: white;
            bottom: 10%;
            right: 10%;
            animation-delay: 5s;
        }

        .shape-3 {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: white;
            top: 50%;
            right: 20%;
            animation-delay: 10s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(20px) rotate(240deg); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* App Sections */
        .app-section {
            display: none;
            min-height: 100vh;
            animation: fadeIn 0.5s ease;
        }

        .app-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Header Styles */
        .app-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .app-header h1 {
            font-weight: 600;
            display: inline-block;
        }

        .back-button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            transform: translateX(-5px);
        }

        /* Borrowing Form Styles */
        .borrowing-container {
            padding: 2rem 0;
        }

        .card {
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: none;
            margin-bottom: 1.5rem;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background-color: white;
            border-bottom: 2px solid var(--primary-color);
            font-weight: 600;
            padding: 1.25rem 1.5rem;
            border-radius: 15px 15px 0 0 !important;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--dark-text);
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid #ced4da;
            padding: 0.75rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--success-color);
            color: var(--dark-text);
            border: none;
            padding: 0.5rem 1rem;
            font-weight: 500;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .btn-success:hover {
            background-color: #00e894;
            color: var(--dark-text);
            transform: translateY(-2px);
        }

        .office-supplies-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 0.75rem;
            background-color: white;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .office-supplies-item:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        .office-supplies-icon {
            margin-right: 1rem;
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .office-supplies-details {
            flex-grow: 1;
        }

        .office-supplies-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .office-supplies-quantity {
            display: flex;
            align-items: center;
            background-color: #f8f9fa;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .quantity-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 50px;
            margin-left: 0.5rem;
            min-width: 2rem;
            text-align: center;
            font-weight: 600;
        }

        .quantity-low {
            background-color: var(--danger-color);
        }

        .quantity-medium {
            background-color: var(--warning-color);
        }

        .quantity-high {
            background-color: var(--success-color);
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid #dee2e6;
            background: white;
            color: var(--dark-text);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quantity-btn:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .quantity-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .quantity-input {
            width: 60px;
            text-align: center;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 0.25rem;
        }

        /* Admin Dashboard Styles */
        .admin-container {
            padding: 2rem 0;
        }

        .sidebar {
            background-color: white;
            min-height: calc(100vh - 100px);
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            margin-right: 1.5rem;
        }

        .sidebar .nav-link {
            color: var(--dark-text);
            padding: 0.75rem 1rem;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .sidebar .nav-link:hover {
            background-color: #f8f9fa;
            color: var(--primary-color);
            transform: translateX(5px);
        }

        .sidebar .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }

        .sidebar .nav-link i {
            margin-right: 0.75rem;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .stat-icon.primary {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .stat-icon.success {
            background-color: rgba(6, 255, 165, 0.1);
            color: var(--success-color);
        }

        .stat-icon.warning {
            background-color: rgba(255, 190, 11, 0.1);
            color: var(--warning-color);
        }

        .stat-icon.danger {
            background-color: rgba(255, 0, 110, 0.1);
            color: var(--danger-color);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .item-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }

        .item-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .item-info {
            display: flex;
            align-items: center;
        }

        .item-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 1rem;
        }

        .item-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .item-quantity {
            display: flex;
            align-items: center;
            margin-top: 0.5rem;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .btn-icon:hover {
            transform: scale(1.1);
        }

        .btn-icon.edit {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .btn-icon.delete {
            background-color: rgba(255, 0, 110, 0.1);
            color: var(--danger-color);
        }

        /* Table Styles */
        .table {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .table thead {
            background-color: var(--primary-color);
            color: white;
        }

        .table th {
            border: none;
            padding: 1rem;
            font-weight: 500;
        }

        .table td {
            padding: 1rem;
            vertical-align: middle;
        }

        .table tbody tr {
            border-bottom: 1px solid #e9ecef;
            transition: background-color 0.3s ease;
        }

        .table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .badge {
            padding: 0.5rem 1rem;
            font-weight: 500;
            border-radius: 50px;
        }

        .badge-returned {
            background-color: #d4edda;
            color: #155724;
        }

        .badge-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .badge-overdue {
            background-color: #f8d7da;
            color: #721c24;
        }

        .badge-partial {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        /* Modal Styles */
        .modal-content {
            border-radius: 20px;
            border: none;
        }

        .modal-header {
            border-bottom: 1px solid #e9ecef;
            padding: 1.5rem;
            border-radius: 20px 20px 0 0;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            border-top: 1px solid #e9ecef;
            padding: 1.5rem;
            border-radius: 0 0 20px 20px;
        }

        /* Login Modal */
        .login-modal .modal-dialog {
            max-width: 400px;
        }

        .login-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 1.5rem;
        }

        /* Return Items Modal */
        .return-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
        }

        .return-item-info {
            flex-grow: 1;
        }

        .return-item-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .return-item-details {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.875rem;
            color: #6c757d;
        }

        .return-quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .return-checkbox {
            margin-right: 1rem;
            transform: scale(1.2);
        }

        /* Toast Styles */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .custom-toast {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-icon {
            margin-right: 1rem;
            font-size: 1.5rem;
        }

        .toast-success .toast-icon {
            color: #28a745;
        }

        .toast-error .toast-icon {
            color: #dc3545;
        }

        .toast-content {
            flex-grow: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .toast-message {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: #6c757d;
            cursor: pointer;
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            z-index: 1000;
        }

        .connection-status.connected {
            background-color: #d4edda;
            color: #155724;
        }

        .connection-status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }

        .connection-status i {
            margin-right: 0.5rem;
        }

        /* Empty State Styles */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: #dee2e6;
        }

        .empty-state-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #495057;
        }

        .empty-state-description {
            margin-bottom: 1.5rem;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Filter Section Styles */
        .filter-section {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .filter-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--dark-text);
        }

        .filter-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            border: 1px solid #dee2e6;
            background: white;
            color: var(--dark-text);
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .filter-btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
        }

        .filter-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .filter-btn.low-stock {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        .filter-btn.low-stock.active {
            background: var(--danger-color);
            color: white;
        }

        .filter-btn.medium-stock {
            border-color: var(--warning-color);
            color: var(--warning-color);
        }

        .filter-btn.medium-stock.active {
            background: var(--warning-color);
            color: white;
        }

        .filter-btn.high-stock {
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .filter-btn.high-stock.active {
            background: var(--success-color);
            color: white;
        }

        /* Summary Card Styles */
        .summary-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .summary-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .summary-item:last-child {
            border-bottom: none;
            padding-top: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Status Section Styles */
        .status-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        .status-tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #6c757d;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .status-tab:hover {
            color: var(--primary-color);
        }

        .status-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .status-tab .badge {
            position: absolute;
            top: -5px;
            right: -10px;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            min-width: 20px;
        }

        .status-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .status-content.active {
            display: block;
        }

        /* Mobile Navigation Toggle */
        .mobile-nav-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            margin-right: 0.75rem;
        }

        .mobile-nav-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Mobile Navigation Menu */
        .mobile-nav-menu {
            position: fixed;
            top: 0;
            left: -100%;
            width: 280px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1050;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        .mobile-nav-menu.active {
            left: 0;
        }

        .mobile-nav-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mobile-nav-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .mobile-nav-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .mobile-nav-body {
            padding: 1rem;
        }

        .mobile-nav-link {
            display: block;
            padding: 0.75rem 1rem;
            color: var(--dark-text);
            border-radius: 10px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .mobile-nav-link:hover {
            background-color: #f8f9fa;
            color: var(--primary-color);
        }

        .mobile-nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }

        .mobile-nav-link i {
            margin-right: 0.75rem;
        }

        /* Mobile Overlay */
        .mobile-nav-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1040;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .mobile-nav-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Mobile Card View for Tables */
        .mobile-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
        }

        .mobile-card-header {
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e9ecef;
        }

        .mobile-card-row {
            display: flex;
            margin-bottom: 0.5rem;
        }

        .mobile-card-label {
            font-weight: 500;
            width: 40%;
            color: #6c757d;
        }

        .mobile-card-value {
            width: 60%;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .landing-title {
                font-size: 2.5rem;
            }
            .sidebar {
                display: none;
            }
            .mobile-nav-toggle {
                display: block;
            }
            .admin-container .row > div:last-child {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .landing-title {
                font-size: 2rem;
                flex-direction: column;
                white-space: normal;
                text-align: center;
            }
            .landing-title .logo {
                height: 50px;
                margin-right: 0;
                margin-bottom: 10px;
            }
            .choice-buttons {
                flex-direction: column;
                align-items: center;
            }
            .choice-card {
                width: 100%;
                max-width: 300px;
            }
            .app-header {
                padding: 1rem 0;
            }
            .app-header h1 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            .back-button {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
            .borrowing-container {
                padding: 1rem 0;
            }
            .card {
                margin-bottom: 1rem;
            }
            .card-header {
                padding: 1rem;
                font-size: 1.1rem;
            }
            .office-supplies-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 1.25rem;
            }
            .office-supplies-icon {
                font-size: 1.75rem;
                margin-bottom: 0.75rem;
            }
            .office-supplies-details {
                width: 100%;
                margin-bottom: 1rem;
            }
            .office-supplies-name {
                font-size: 1.1rem;
            }
            .office-supplies-quantity {
                font-size: 1rem;
                padding: 0.5rem 1rem;
            }
            .quantity-selector {
                width: 100%;
                justify-content: space-between;
                margin-top: 0.5rem;
            }
            .quantity-btn {
                width: 44px;
                height: 44px;
                font-size: 1.2rem;
            }
            .quantity-input {
                width: 80px;
                font-size: 1.1rem;
                padding: 0.5rem;
            }
            .summary-card {
                padding: 1.25rem;
            }
            .summary-title {
                font-size: 1.1rem;
            }
            .admin-container {
                padding: 1rem 0;
            }
            .stat-card {
                padding: 1.25rem;
                margin-bottom: 1rem;
            }
            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
            .stat-value {
                font-size: 1.75rem;
            }
            .stat-label {
                font-size: 0.8rem;
            }
            .filter-section {
                padding: 1rem;
            }
            .filter-buttons {
                gap: 0.5rem;
            }
            .filter-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
            .item-card {
                padding: 1.25rem;
            }
            .item-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .item-info {
                margin-bottom: 1rem;
            }
            .item-icon {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
            .item-name {
                font-size: 1rem;
            }
            .item-actions {
                width: 100%;
                justify-content: flex-end;
            }
            .btn-icon {
                width: 44px;
                height: 44px;
            }
            .status-tabs {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            .status-tab {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            .table {
                display: none;
            }
            .mobile-table-container {
                display: block;
            }
            .mobile-card {
                padding: 1rem;
            }
            .mobile-card-header {
                font-size: 1.1rem;
            }
            .mobile-card-row {
                margin-bottom: 0.75rem;
            }
            .mobile-card-label {
                font-size: 0.9rem;
            }
            .mobile-card-value {
                font-size: 0.9rem;
            }
            .modal-dialog {
                margin: 0.5rem;
                max-width: calc(100% - 1rem);
            }
            .modal-header {
                padding: 1rem;
            }
            .modal-body {
                padding: 1rem;
            }
            .modal-footer {
                padding: 1rem;
            }
            .return-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .return-checkbox {
                margin-bottom: 0.75rem;
                transform: scale(1.5);
            }
            .return-quantity-control {
                width: 100%;
                justify-content: space-between;
                margin-top: 0.75rem;
            }
            .return-quantity-control .quantity-btn {
                width: 44px;
                height: 44px;
                font-size: 1.2rem;
            }
            .return-quantity-control .quantity-input {
                width: 80px;
                font-size: 1.1rem;
                padding: 0.5rem;
            }
            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
            }
            .custom-toast {
                min-width: auto;
                width: 100%;
            }
            .connection-status {
                bottom: 10px;
                right: 10px;
                left: 10px;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .landing-title {
                font-size: 1.75rem;
            }
            .landing-subtitle {
                font-size: 1.1rem;
            }
            .choice-card {
                padding: 2rem;
            }
            .choice-icon {
                font-size: 2.5rem;
            }
            .choice-title {
                font-size: 1.3rem;
            }
            .app-header h1 {
                font-size: 1.25rem;
            }
            .back-button {
                padding: 0.35rem 0.7rem;
                font-size: 0.85rem;
            }
            .card-header {
                font-size: 1rem;
            }
            .form-label {
                font-size: 0.95rem;
            }
            .form-control, .form-select {
                padding: 0.6rem;
                font-size: 0.95rem;
            }
            .btn-primary, .btn-success {
                padding: 0.6rem 1.2rem;
                font-size: 0.95rem;
            }
            .office-supplies-item {
                padding: 1rem;
            }
            .office-supplies-icon {
                font-size: 1.5rem;
            }
            .office-supplies-name {
                font-size: 1rem;
            }
            .quantity-btn {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }
            .quantity-input {
                width: 70px;
                font-size: 1rem;
            }
            .stat-card {
                padding: 1rem;
            }
            .stat-icon {
                width: 45px;
                height: 45px;
                font-size: 1.2rem;
            }
            .stat-value {
                font-size: 1.5rem;
            }
            .stat-label {
                font-size: 0.75rem;
            }
            .item-card {
                padding: 1rem;
            }
            .item-icon {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            .item-name {
                font-size: 0.95rem;
            }
            .btn-icon {
                width: 40px;
                height: 40px;
            }
            .status-tab {
                padding: 0.4rem 0.8rem;
                font-size: 0.85rem;
            }
            .mobile-card {
                padding: 0.75rem;
            }
            .mobile-card-header {
                font-size: 1rem;
            }
            .mobile-card-label {
                font-size: 0.85rem;
            }
            .mobile-card-value {
                font-size: 0.85rem;
            }
            .modal-header {
                padding: 0.75rem;
            }
            .modal-body {
                padding: 0.75rem;
            }
            .modal-footer {
                padding: 0.75rem;
            }
            .return-quantity-control .quantity-btn {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }
            .return-quantity-control .quantity-input {
                width: 70px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Screen -->
    <div id="landingScreen" class="landing-screen">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
        <div class="landing-content">
            <h1 class="landing-title">
                <img src="htbblogo.jpg" alt="HTBB Logo" class="logo">
                Office Supplies Management System
            </h1>
            <p class="landing-subtitle">Efficiently track and manage office supplies borrowing</p>
            <div class="choice-buttons">
                <div class="choice-card" onclick="showBorrowingForm()">
                    <div class="choice-icon">
                        <i class="bi bi-pencil-square"></i>
                    </div>
                    <h3 class="choice-title">Borrow Office Supplies</h3>
                </div>
                <div class="choice-card" onclick="showAdminLogin()">
                    <div class="choice-icon">
                        <i class="bi bi-gear-fill"></i>
                    </div>
                    <h3 class="choice-title">Admin Portal</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Borrowing Form Section -->
    <div id="borrowingSection" class="app-section">
        <header class="app-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h1 class="mb-0">
                            <i class="bi bi-pencil-square me-2"></i>Office Supplies Request Form
                        </h1>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <a href="#" class="back-button" onclick="showLandingScreen()">
                            <i class="bi bi-arrow-left me-2"></i>Back to Home
                        </a>
                    </div>
                </div>
            </div>
        </header>
        <div class="container borrowing-container">
            <div class="row">
                <div class="col-lg-5">
                    <div class="card">
                        <div class="card-header">
                            <i class="bi bi-clipboard-plus me-2"></i>Request Form
                        </div>
                        <div class="card-body">
                            <form id="borrowForm">
                                <div class="mb-4">
                                    <label class="form-label">Select Items to Borrow</label>
                                    <div class="office-supplies-list" id="officeSuppliesList">
                                        <!-- Items will be loaded dynamically -->
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="borrowerName" class="form-label">Your Name</label>
                                    <input type="text" class="form-control" id="borrowerName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="purpose" class="form-label">Purpose</label>
                                    <textarea class="form-control" id="purpose" rows="2" placeholder="(e.g. CHTBB, Alpha, ARG, Youth)" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="borrowDate" class="form-label">Borrow Date</label>
                                    <input type="date" class="form-control" id="borrowDate" required readonly>
                                </div>
                                <div class="mb-3">
                                    <label for="returnDate" class="form-label">Expected Return Date</label>
                                    <input type="date" class="form-control" id="returnDate" required>
                                </div>
                                <!-- Summary Card -->
                                <div class="summary-card" id="summaryCard" style="display: none;">
                                    <div class="summary-title">
                                        <i class="bi bi-cart-check me-2"></i>Request Summary
                                    </div>
                                    <div id="summaryItems">
                                        <!-- Summary items will be loaded dynamically -->
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="bi bi-check-circle me-2"></i>Submit Request
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-7">
                    <div class="card">
                        <div class="card-header">
                            <i class="bi bi-clock-history me-2"></i>Recent Borrowing Records
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Borrower</th>
                                            <th>Items</th>
                                            <th>Borrow Date</th>
                                            <th>Return Date</th>
                                            <th>Status</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentBorrowingTable">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted">Loading records...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- Mobile Table View -->
                            <div class="mobile-table-container" id="recentBorrowingMobile" style="display: none;">
                                <!-- Mobile cards will be loaded dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard Section -->
    <div id="adminSection" class="app-section">
        <header class="app-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-6 d-flex align-items-center">
                        <button class="mobile-nav-toggle" onclick="toggleMobileNav()">
                            <i class="bi bi-list"></i>
                        </button>
                        <h1 class="mb-0">
                            <i class="bi bi-gear-fill me-2"></i>Admin Dashboard
                        </h1>
                    </div>
                    <div class="col-6 text-end">
                        <a href="#" class="back-button d-none d-md-inline-block" onclick="showLandingScreen()">
                            <i class="bi bi-arrow-left me-2"></i>Back to Home
                        </a>
                    </div>
                </div>
            </div>
        </header>
        <div class="container admin-container">
            <div class="row">
                <div class="col-md-3 d-none d-lg-block">
                    <div class="sidebar">
                        <nav class="nav flex-column">
                            <a class="nav-link active" href="#" onclick="showAdminSection('dashboard')">
                                <i class="bi bi-speedometer2"></i>Dashboard
                            </a>
                            <a class="nav-link" href="#" onclick="showAdminSection('inventory')">
                                <i class="bi bi-box"></i>Inventory Management
                            </a>
                            <a class="nav-link" href="#" onclick="showAdminSection('status')">
                                <i class="bi bi-list-check"></i>Item Status
                            </a>
                            <a class="nav-link" href="#" onclick="showAdminSection('records')">
                                <i class="bi bi-clock-history"></i>All Records
                            </a>
                        </nav>
                    </div>
                </div>
                <div class="col-md-12 col-lg-9">
                    <!-- Dashboard Section -->
                    <div id="adminDashboard" class="content-section active">
                        <h2 class="mb-4">Dashboard Overview</h2>
                        <div class="row">
                            <div class="col-md-6 col-lg-3">
                                <div class="stat-card">
                                    <div class="stat-icon primary">
                                        <i class="bi bi-box"></i>
                                    </div>
                                    <div class="stat-value" id="totalItems">0</div>
                                    <div class="stat-label">Total Items</div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <div class="stat-card">
                                    <div class="stat-icon success">
                                        <i class="bi bi-check-circle"></i>
                                    </div>
                                    <div class="stat-value" id="availableItems">0</div>
                                    <div class="stat-label">Available Items</div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <div class="stat-card">
                                    <div class="stat-icon warning">
                                        <i class="bi bi-arrow-repeat"></i>
                                    </div>
                                    <div class="stat-value" id="activeBorrows">0</div>
                                    <div class="stat-label">Active Borrows</div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <div class="stat-card">
                                    <div class="stat-icon danger">
                                        <i class="bi bi-exclamation-triangle"></i>
                                    </div>
                                    <div class="stat-value" id="lowStock">0</div>
                                    <div class="stat-label">Low Stock Items</div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-graph-up me-2"></i>Recent Activity
                            </div>
                            <div class="card-body">
                                <div id="recentActivity">
                                    <p class="text-muted">Loading recent activity...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Inventory Management Section -->
                    <div id="adminInventory" class="content-section">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2>Inventory Management</h2>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addItemModal">
                                <i class="bi bi-plus-circle me-2"></i>Add New Item
                            </button>
                        </div>
                        <!-- Filter Section -->
                        <div class="filter-section">
                            <div class="filter-title">Filter by Stock Level</div>
                            <div class="filter-buttons">
                                <button class="filter-btn active" onclick="filterItems('all')">
                                    <i class="bi bi-grid-3x3-gap me-1"></i>All Items
                                </button>
                                <button class="filter-btn high-stock" onclick="filterItems('high')">
                                    <i class="bi bi-check-circle me-1"></i>High Stock (>6)
                                </button>
                                <button class="filter-btn medium-stock" onclick="filterItems('medium')">
                                    <i class="bi bi-dash-circle me-1"></i>Medium Stock (4-6)
                                </button>
                                <button class="filter-btn low-stock" onclick="filterItems('low')">
                                    <i class="bi bi-exclamation-triangle me-1"></i>Low Stock (≤3)
                                </button>
                            </div>
                        </div>
                        <div id="inventoryList">
                            <p class="text-muted">Loading inventory...</p>
                        </div>
                    </div>

                    <!-- Item Status Section -->
                    <div id="adminStatus" class="content-section">
                        <h2 class="mb-4">Item Status Overview</h2>
                        <div class="status-tabs">
                            <button class="status-tab active" onclick="showStatusTab('pending')">
                                On Loan
                                <span class="badge bg-warning" id="pendingCount">0</span>
                            </button>
                            <button class="status-tab" onclick="showStatusTab('overdue')">
                                Overdue
                                <span class="badge bg-danger" id="overdueCount">0</span>
                            </button>
                            <button class="status-tab" onclick="showStatusTab('partial')">
                                Partial Return
                                <span class="badge bg-info" id="partialCount">0</span>
                            </button>
                            <button class="status-tab" onclick="showStatusTab('returned')">
                                Returned
                                <span class="badge bg-success" id="returnedCount">0</span>
                            </button>
                        </div>
                        <!-- Pending Items -->
                        <div id="pendingItems" class="status-content active">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-clock me-2"></i>Items On Loan
                                </div>
                                <div class="card-body">
                                    <div id="pendingItemsList">
                                        <p class="text-muted">Loading items on loan...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Overdue Items -->
                        <div id="overdueItems" class="status-content">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-exclamation-triangle me-2"></i>Overdue Items
                                </div>
                                <div class="card-body">
                                    <div id="overdueItemsList">
                                        <p class="text-muted">Loading overdue items...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Partial Return Items -->
                        <div id="partialItems" class="status-content">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-arrow-left-right me-2"></i>Partial Returns
                                </div>
                                <div class="card-body">
                                    <div id="partialItemsList">
                                        <p class="text-muted">Loading partial returns...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Returned Items -->
                        <div id="returnedItems" class="status-content">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-check-circle me-2"></i>Recently Returned
                                </div>
                                <div class="card-body">
                                    <div id="returnedItemsList">
                                        <p class="text-muted">Loading returned items...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Records Section -->
                    <div id="adminRecords" class="content-section">
                        <h2 class="mb-4">All Borrowing Records</h2>
                        <div class="mb-3">
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-search"></i></span>
                                <input type="text" class="form-control" id="recordsSearch" placeholder="Search by borrower name or purpose...">
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Borrower</th>
                                        <th>Items</th>
                                        <th>Purpose</th>
                                        <th>Borrow Date</th>
                                        <th>Return Date</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="recordsTableBody">
                                    <tr>
                                        <td colspan="8" class="text-center text-muted">Loading records...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- Mobile Table View -->
                        <div class="mobile-table-container" id="recordsMobile" style="display: none;">
                            <!-- Mobile cards will be loaded dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <div class="mobile-nav-menu" id="mobileNavMenu">
        <div class="mobile-nav-header">
            <h5 class="mb-0">Admin Menu</h5>
            <button class="mobile-nav-close" onclick="toggleMobileNav()">
                <i class="bi bi-x"></i>
            </button>
        </div>
        <div class="mobile-nav-body">
            <a class="mobile-nav-link active" href="#" onclick="showAdminSection('dashboard'); toggleMobileNav();">
                <i class="bi bi-speedometer2"></i>Dashboard
            </a>
            <a class="mobile-nav-link" href="#" onclick="showAdminSection('inventory'); toggleMobileNav();">
                <i class="bi bi-box"></i>Inventory Management
            </a>
            <a class="mobile-nav-link" href="#" onclick="showAdminSection('status'); toggleMobileNav();">
                <i class="bi bi-list-check"></i>Item Status
            </a>
            <a class="mobile-nav-link" href="#" onclick="showAdminSection('records'); toggleMobileNav();">
                <i class="bi bi-clock-history"></i>All Records
            </a>
            <hr>
            <a class="mobile-nav-link" href="#" onclick="showLandingScreen(); toggleMobileNav();">
                <i class="bi bi-house"></i>Back to Home
            </a>
        </div>
    </div>

    <!-- Mobile Navigation Overlay -->
    <div class="mobile-nav-overlay" id="mobileNavOverlay" onclick="toggleMobileNav()"></div>

    <!-- Admin Login Modal -->
    <div class="modal fade login-modal" id="adminLoginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Admin Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="login-icon">
                        <i class="bi bi-shield-lock"></i>
                    </div>
                    <form id="adminLoginForm">
                        <div class="mb-3">
                            <label for="adminPassword" class="form-label">Admin Password</label>
                            <input type="password" class="form-control" id="adminPassword" placeholder="Enter admin password" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-box-arrow-in-right me-2"></i>Login
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div class="modal fade" id="addItemModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Office Supplies Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addItemForm">
                        <div class="mb-3">
                            <label for="itemName" class="form-label">Item Name</label>
                            <input type="text" class="form-control" id="itemName" required>
                        </div>
                        <div class="mb-3">
                            <label for="itemQuantity" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="itemQuantity" min="0" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addNewItem()">Add Item</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Item Modal -->
    <div class="modal fade" id="editItemModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Office Supplies Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editItemForm">
                        <input type="hidden" id="editItemId">
                        <div class="mb-3">
                            <label for="editItemName" class="form-label">Item Name</label>
                            <input type="text" class="form-control" id="editItemName" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateItem()">Update Item</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Return Items Modal -->
    <div class="modal fade" id="returnItemsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-box-arrow-in-left me-2"></i>Return Items
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <strong>Borrower:</strong> <span id="returnBorrowerName"></span>
                    </div>
                    <div class="mb-3">
                        <strong>Purpose:</strong> <span id="returnPurpose"></span>
                    </div>
                    <hr>
                    <div id="returnItemsList">
                        <!-- Return items will be loaded dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="processReturn()">
                        <i class="bi bi-check-circle me-2"></i>Process Return
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Connection Status -->
    <div class="connection-status disconnected" id="connectionStatus">
        <i class="bi bi-wifi-off"></i>
        <span>Disconnected</span>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <!-- Custom JavaScript -->
    <script>
        // Firebase configuration - REPLACE WITH YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyCeQQz9A6r3gMRWR-gQ4G62sMG3HO9NK70",
            authDomain: "stationery-htbb.firebaseapp.com",
            databaseURL: "https://stationery-htbb-default-rtdb.firebaseio.com/",
            projectId: "stationery-htbb",
            storageBucket: "stationery-htbb.appspot.com",
            messagingSenderId: "123456789012", // Replace with actual sender ID
            appId: "1:123456789012:web:abcdef123456789012345678" // Replace with actual app ID
        };

        // Initialize Firebase
        let database, borrowingLogRef, inventoryRef, itemsRef;
        let borrowingLog = [];
        let nextId = 1;
        let inventory = {};
        let items = {};
        let currentFilter = 'all';
        let selectedQuantities = {};
        let currentReturnId = null;
        let returnQuantities = {};

        // Admin password
        const ADMIN_PASSWORD = "htbb";

        // Date formatting function for dd/mm/yyyy
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'Invalid Date';
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Initialize Firebase connection
        function initializeFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                borrowingLogRef = database.ref('borrowingLog');
                inventoryRef = database.ref('inventory');
                itemsRef = database.ref('items');
                
                // Set up Firebase listeners
                setupFirebaseListeners();
                
                // Update connection status
                updateConnectionStatus(true);
            } catch (error) {
                console.error("Firebase initialization error:", error);
                updateConnectionStatus(false);
                showToast('error', 'Firebase Error', 'Failed to initialize Firebase. Please check your configuration.');
            }
        }

        // Set up Firebase listeners
        function setupFirebaseListeners() {
            // Listen for borrowing log changes
            borrowingLogRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    borrowingLog = Object.keys(data).map(key => ({
                        id: parseInt(key),
                        ...data[key]
                    }));
                    
                    // Find the highest ID for next entry
                    if (borrowingLog.length > 0) {
                        nextId = Math.max(...borrowingLog.map(item => item.id)) + 1;
                    }
                } else {
                    borrowingLog = [];
                    nextId = 1;
                }
                
                updateDashboardStats();
                updateRecordsTable();
                updateRecentActivity();
                updateRecentBorrowingTable();
                updateStatusCounts();
                updateStatusLists();
            });

            // Listen for inventory changes
            inventoryRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    inventory = data;
                } else {
                    inventory = {};
                }
                
                updateDashboardStats();
                renderInventory();
                updateOfficeSuppliesQuantities();
            });

            // Listen for items changes
            itemsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    items = data;
                } else {
                    // Initialize with empty items if none exist
                    items = {};
                    itemsRef.set(items);
                }
                
                updateDashboardStats();
                renderInventory();
                renderOfficeSuppliesItems();
                updateOfficeSuppliesQuantities();
            });
        }

        // Navigation functions
        function showLandingScreen() {
            hideAllSections();
            document.getElementById('landingScreen').style.display = 'flex';
        }

        function showBorrowingForm() {
            hideAllSections();
            document.getElementById('borrowingSection').classList.add('active');
            setDefaultDates();
            selectedQuantities = {};
            updateSummary();
        }

        function showAdminLogin() {
            const modal = new bootstrap.Modal(document.getElementById('adminLoginModal'));
            modal.show();
        }

        function showAdminSection(sectionId) {
            // Hide all admin sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById('admin' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1)).classList.add('active');
            
            // Update active nav link
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            document.querySelectorAll('.mobile-nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Find and activate the correct link
            const sidebarLink = document.querySelector(`.sidebar .nav-link[onclick*="${sectionId}"]`);
            if (sidebarLink) {
                sidebarLink.classList.add('active');
            }
            
            const mobileLink = document.querySelector(`.mobile-nav-link[onclick*="${sectionId}"]`);
            if (mobileLink) {
                mobileLink.classList.add('active');
            }
        }

        function hideAllSections() {
            document.getElementById('landingScreen').style.display = 'none';
            document.getElementById('borrowingSection').classList.remove('active');
            document.getElementById('adminSection').classList.remove('active');
        }

        // Toggle mobile navigation
        function toggleMobileNav() {
            const navMenu = document.getElementById('mobileNavMenu');
            const navOverlay = document.getElementById('mobileNavOverlay');
            const body = document.body;
            
            if (!navMenu || !navOverlay) return;
            
            // Toggle active class on menu and overlay
            navMenu.classList.toggle('active');
            navOverlay.classList.toggle('active');
            
            // Prevent body scroll when menu is open
            if (navMenu.classList.contains('active')) {
                body.style.overflow = 'hidden';
            } else {
                body.style.overflow = '';
            }
        }

        // Set default dates for borrowing form
        function setDefaultDates() {
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            document.getElementById('borrowDate').value = todayString;
            
            // Set default return date to 3 days from now
            const returnDate = new Date(today);
            returnDate.setDate(today.getDate() + 3);
            const returnDateString = returnDate.toISOString().split('T')[0];
            document.getElementById('returnDate').value = returnDateString;
        }

        // Admin login form submission
        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('adminLoginModal')).hide();
                document.getElementById('adminPassword').value = '';
                
                // Show admin dashboard
                hideAllSections();
                document.getElementById('adminSection').classList.add('active');
                
                // Initialize Firebase if not already done
                if (!database) {
                    initializeFirebase();
                }
            } else {
                showToast('error', 'Login Failed', 'Invalid password. Please try again.');
            }
        });

        // Borrowing form submission
        document.getElementById('borrowForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!borrowingLogRef) {
                showToast('error', 'Not Connected', 'Please wait for the system to initialize.');
                return;
            }
            
            // Get form values
            const borrowerName = document.getElementById('borrowerName').value.trim();
            const purpose = document.getElementById('purpose').value.trim();
            const borrowDate = document.getElementById('borrowDate').value;
            const returnDate = document.getElementById('returnDate').value;
            
            // Validate form
            if (!borrowerName) {
                showToast('error', 'Validation Error', 'Please enter your name.');
                return;
            }
            
            if (!purpose) {
                showToast('error', 'Validation Error', 'Please enter a purpose.');
                return;
            }
            
            // Get selected office supplies items with quantities
            const selectedItems = [];
            let itemsAvailable = true;
            let unavailableItems = [];
            let selectedItemIds = [];
            
            Object.entries(selectedQuantities).forEach(([itemId, quantity]) => {
                if (quantity > 0) {
                    const item = items[itemId];
                    if (!item) return;
                    
                    const availableQuantity = inventory[itemId] || 0;
                    
                    if (availableQuantity < quantity) {
                        itemsAvailable = false;
                        unavailableItems.push(`${item.name} (requested: ${quantity}, available: ${availableQuantity})`);
                    } else {
                        selectedItems.push({
                            name: item.name,
                            quantity: quantity,
                            returned: 0 // Track returned quantity
                        });
                        selectedItemIds.push({
                            id: itemId,
                            quantity: quantity
                        });
                    }
                }
            });
            
            if (selectedItems.length === 0) {
                showToast('error', 'No Items Selected', 'Please select at least one office supplies item with quantity.');
                return;
            }
            
            if (!itemsAvailable) {
                showToast('error', 'Insufficient Stock', `The following items don't have enough stock: ${unavailableItems.join(', ')}`);
                return;
            }
            
            // Create new log entry
            const newEntry = {
                borrowerName,
                purpose,
                borrowDate,
                returnDate,
                items: selectedItems,
                status: 'pending',
                actualReturnDate: null
            };
            
            // Add to Firebase
            borrowingLogRef.child(nextId).set(newEntry)
                .then(() => {
                    // Update inventory quantities
                    const inventoryUpdates = {};
                    selectedItemIds.forEach(({ id, quantity }) => {
                        inventoryUpdates[id] = (inventory[id] || 0) - quantity;
                    });
                    
                    inventoryRef.update(inventoryUpdates)
                        .then(() => {
                            // Reset form
                            this.reset();
                            setDefaultDates();
                            selectedQuantities = {};
                            updateSummary();
                            
                            // Show success message
                            showToast('success', 'Request Submitted', 'Your borrowing request has been recorded successfully.');
                        })
                        .catch((error) => {
                            console.error("Error updating inventory:", error);
                            showToast('error', 'Inventory Error', 'Failed to update inventory quantities.');
                        });
                })
                .catch((error) => {
                    console.error("Error adding document: ", error);
                    showToast('error', 'Submission Error', 'Failed to submit your request. Please try again.');
                });
        });

        // Render office supplies items dynamically
        function renderOfficeSuppliesItems() {
            const officeSuppliesList = document.getElementById('officeSuppliesList');
            if (!officeSuppliesList) return;
            
            officeSuppliesList.innerHTML = '';
            
            if (!items || Object.keys(items).length === 0) {
                officeSuppliesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="bi bi-inbox"></i>
                        </div>
                        <div class="empty-state-title">No Office Supplies Items Available</div>
                        <div class="empty-state-description">
                            There are currently no office supplies items in the system. Please contact the administrator to add items.
                        </div>
                    </div>
                `;
                return;
            }
            
            Object.entries(items).forEach(([id, item]) => {
                if (!item) return;
                
                const quantity = inventory[id] || 0;
                let quantityClass = 'quantity-high';
                
                if (quantity <= 3) {
                    quantityClass = 'quantity-low';
                } else if (quantity <= 6) {
                    quantityClass = 'quantity-medium';
                }
                
                const selectedQuantity = selectedQuantities[id] || 0;
                
                const officeSuppliesItem = document.createElement('div');
                officeSuppliesItem.className = 'office-supplies-item';
                officeSuppliesItem.innerHTML = `
                    <i class="bi bi-box office-supplies-icon"></i>
                    <div class="office-supplies-details">
                        <div class="office-supplies-name">${item.name}</div>
                        <div class="office-supplies-quantity">
                            <span>Available:</span>
                            <span class="quantity-badge ${quantityClass}" id="${id}-available">${quantity}</span>
                        </div>
                    </div>
                    <div class="quantity-selector">
                        <button type="button" class="quantity-btn" onclick="decreaseQuantity('${id}')" ${selectedQuantity <= 0 ? 'disabled' : ''}>
                            <i class="bi bi-dash"></i>
                        </button>
                        <input type="number" class="quantity-input" id="${id}-quantity" value="${selectedQuantity}" min="0" max="${quantity}" readonly>
                        <button type="button" class="quantity-btn" onclick="increaseQuantity('${id}')" ${selectedQuantity >= quantity ? 'disabled' : ''}>
                            <i class="bi bi-plus"></i>
                        </button>
                    </div>
                `;
                
                officeSuppliesList.appendChild(officeSuppliesItem);
            });
        }

        // Increase quantity for an item
        function increaseQuantity(itemId) {
            if (!inventory || !items) return;
            
            const available = inventory[itemId] || 0;
            const current = selectedQuantities[itemId] || 0;
            
            if (current < available) {
                selectedQuantities[itemId] = current + 1;
                const input = document.getElementById(`${itemId}-quantity`);
                if (input) input.value = selectedQuantities[itemId];
                
                // Update button states
                const decreaseBtn = document.querySelector(`button[onclick="decreaseQuantity('${itemId}')"]`);
                const increaseBtn = document.querySelector(`button[onclick="increaseQuantity('${itemId}')"]`);
                
                if (decreaseBtn) decreaseBtn.disabled = false;
                if (increaseBtn && selectedQuantities[itemId] >= available) {
                    increaseBtn.disabled = true;
                }
                
                updateSummary();
            }
        }

        // Decrease quantity for an item
        function decreaseQuantity(itemId) {
            const current = selectedQuantities[itemId] || 0;
            
            if (current > 0) {
                selectedQuantities[itemId] = current - 1;
                const input = document.getElementById(`${itemId}-quantity`);
                if (input) input.value = selectedQuantities[itemId];
                
                // Update button states
                const decreaseBtn = document.querySelector(`button[onclick="decreaseQuantity('${itemId}')"]`);
                const increaseBtn = document.querySelector(`button[onclick="increaseQuantity('${itemId}')"]`);
                
                if (increaseBtn) increaseBtn.disabled = false;
                if (decreaseBtn && selectedQuantities[itemId] <= 0) {
                    decreaseBtn.disabled = true;
                }
                
                updateSummary();
            }
        }

        // Update order summary
        function updateSummary() {
            const summaryCard = document.getElementById('summaryCard');
            const summaryItems = document.getElementById('summaryItems');
            
            if (!summaryCard || !summaryItems) return;
            
            // Calculate total items and total unique items
            const selectedItems = Object.entries(selectedQuantities).filter(([id, qty]) => qty > 0);
            
            if (selectedItems.length === 0) {
                summaryCard.style.display = 'none';
                return;
            }
            
            summaryCard.style.display = 'block';
            
            let html = '';
            let totalItems = 0;
            
            selectedItems.forEach(([id, quantity]) => {
                const item = items[id];
                if (!item) return;
                
                html += `
                    <div class="summary-item">
                        <span>${item.name}</span>
                        <span>${quantity} unit${quantity > 1 ? 's' : ''}</span>
                    </div>
                `;
                totalItems += quantity;
            });
            
            html += `
                <div class="summary-item">
                    <span>Total Items</span>
                    <span>${totalItems}</span>
                </div>
            `;
            
            summaryItems.innerHTML = html;
        }

        // Update office supplies quantities
        function updateOfficeSuppliesQuantities() {
            if (!items || !inventory) return;
            
            Object.entries(items).forEach(([id, item]) => {
                if (!item) return;
                
                const quantity = inventory[id] || 0;
                const badge = document.getElementById(`${id}-available`);
                const input = document.getElementById(`${id}-quantity`);
                const selectedQuantity = selectedQuantities[id] || 0;
                
                if (badge) {
                    badge.textContent = quantity;
                    badge.classList.remove('quantity-low', 'quantity-medium', 'quantity-high');
                    
                    if (quantity <= 3) {
                        badge.classList.add('quantity-low');
                    } else if (quantity <= 6) {
                        badge.classList.add('quantity-medium');
                    } else {
                        badge.classList.add('quantity-high');
                    }
                }
                
                if (input) {
                    // Adjust selected quantity if it exceeds available stock
                    if (selectedQuantity > quantity) {
                        selectedQuantities[id] = quantity;
                        input.value = quantity;
                    }
                    
                    // Update button states
                    const decreaseBtn = document.querySelector(`button[onclick="decreaseQuantity('${id}')"]`);
                    const increaseBtn = document.querySelector(`button[onclick="increaseQuantity('${id}')"]`);
                    
                    if (decreaseBtn) {
                        decreaseBtn.disabled = selectedQuantity <= 0;
                    }
                    if (increaseBtn) {
                        increaseBtn.disabled = selectedQuantity >= quantity;
                    }
                }
            });
            
            updateSummary();
        }

        // Update recent borrowing table
        function updateRecentBorrowingTable() {
            const tableBody = document.getElementById('recentBorrowingTable');
            const mobileContainer = document.getElementById('recentBorrowingMobile');
            
            if (!tableBody || !mobileContainer) return;
            
            // Get recent records (last 5)
            let recent = [...borrowingLog]
                .sort((a, b) => new Date(b.borrowDate) - new Date(a.borrowDate))
                .slice(0, 5);
            
            // Check for overdue items
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            recent = recent.map(entry => {
                const returnDate = new Date(entry.returnDate);
                returnDate.setHours(0, 0, 0, 0);
                
                if ((entry.status === 'pending' || entry.status === 'on loan') && today > returnDate) {
                    return { ...entry, status: 'overdue' };
                }
                return entry;
            });
            
            if (recent.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No records found</td></tr>';
                mobileContainer.innerHTML = '<div class="empty-state"><p>No records found</p></div>';
                return;
            }
            
            // Check if we should show mobile view
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                // Hide desktop table and show mobile cards
                tableBody.parentElement.parentElement.style.display = 'none';
                mobileContainer.style.display = 'block';
                
                let html = '';
                recent.forEach(entry => {
                    const statusClass = entry.status === 'returned' ? 'badge-returned' : 
                                       entry.status === 'overdue' ? 'badge-overdue' : 
                                       entry.status === 'partial' ? 'badge-partial' : 'badge-pending';
                    
                    const itemsText = entry.items ? entry.items.map(item => {
                        const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                        return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                    }).join(', ') : 'No items';
                    
                    let overdueIndicator = '';
                    if (entry.status === 'overdue') {
                        const returnDate = new Date(entry.returnDate);
                        const daysOverdue = Math.floor((today - returnDate) / (1000 * 60 * 60 * 24));
                        overdueIndicator = `<div class="mt-2"><span class="badge bg-danger">${daysOverdue} days overdue</span></div>`;
                    }
                    
                    const actionButton = entry.status !== 'returned' ? 
                        `<button class="btn btn-success btn-sm w-100" onclick="showReturnModal(${entry.id})">
                            <i class="bi bi-box-arrow-in-left me-1"></i>Return Items
                        </button>` : 
                        '<span class="text-muted">Returned</span>';
                    
                    html += `
                        <div class="mobile-card">
                            <div class="mobile-card-header">${entry.borrowerName}</div>
                            <div class="mobile-card-row">
                                <div class="mobile-card-label">Items:</div>
                                <div class="mobile-card-value">${itemsText}</div>
                            </div>
                            <div class="mobile-card-row">
                                <div class="mobile-card-label">Borrow Date:</div>
                                <div class="mobile-card-value">${formatDate(entry.borrowDate)}</div>
                            </div>
                            <div class="mobile-card-row">
                                <div class="mobile-card-label">Return Date:</div>
                                <div class="mobile-card-value">${formatDate(entry.returnDate)}</div>
                            </div>
                            <div class="mobile-card-row">
                                <div class="mobile-card-label">Status:</div>
                                <div class="mobile-card-value">
                                    <span class="badge ${statusClass}">${getStatusText(entry.status)}</span>
                                    ${overdueIndicator}
                                </div>
                            </div>
                            <div class="mobile-card-row">
                                <div class="mobile-card-label">Action:</div>
                                <div class="mobile-card-value">${actionButton}</div>
                            </div>
                        </div>
                    `;
                });
                
                mobileContainer.innerHTML = html;
            } else {
                // Show desktop table and hide mobile cards
                tableBody.parentElement.parentElement.style.display = 'block';
                mobileContainer.style.display = 'none';
                
                let html = '';
                recent.forEach(entry => {
                    const statusClass = entry.status === 'returned' ? 'badge-returned' : 
                                       entry.status === 'overdue' ? 'badge-overdue' : 
                                       entry.status === 'partial' ? 'badge-partial' : 'badge-pending';
                    
                    const itemsText = entry.items ? entry.items.map(item => {
                        const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                        return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                    }).join(', ') : 'No items';
                    
                    let overdueInfo = '';
                    if (entry.status === 'overdue') {
                        const returnDate = new Date(entry.returnDate);
                        const daysOverdue = Math.floor((today - returnDate) / (1000 * 60 * 60 * 24));
                        overdueInfo = `<div><small class="text-danger"><i class="bi bi-exclamation-triangle me-1"></i>${daysOverdue} days overdue</small></div>`;
                    }
                    
                    const actionButton = entry.status !== 'returned' ? 
                        `<button class="btn btn-success btn-sm" onclick="showReturnModal(${entry.id})">
                            <i class="bi bi-box-arrow-in-left me-1"></i>Return Items
                        </button>` : 
                        '<span class="text-muted">Returned</span>';
                    
                    html += `
                        <tr>
                            <td>${entry.borrowerName}</td>
                            <td>${itemsText}</td>
                            <td>${formatDate(entry.borrowDate)}</td>
                            <td>${formatDate(entry.returnDate)}</td>
                            <td>
                                <span class="badge ${statusClass}">${getStatusText(entry.status)}</span>
                                ${overdueInfo}
                            </td>
                            <td>${actionButton}</td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            }
        }

        // Get status text
        function getStatusText(status) {
            switch(status) {
                case 'pending': 
                case 'on loan': return 'On loan';
                case 'partial': return 'Partial return';
                case 'overdue': return 'Overdue';
                case 'returned': return 'Returned';
                default: return status;
            }
        }

        // Show return modal
        function showReturnModal(id) {
            currentReturnId = id;
            returnQuantities = {};
            
            const entry = borrowingLog.find(e => e.id === id);
            if (!entry) return;
            
            // Set borrower info
            const returnBorrowerName = document.getElementById('returnBorrowerName');
            const returnPurpose = document.getElementById('returnPurpose');
            if (returnBorrowerName) returnBorrowerName.textContent = entry.borrowerName;
            if (returnPurpose) returnPurpose.textContent = entry.purpose;
            
            // Build return items list
            const returnItemsList = document.getElementById('returnItemsList');
            if (!returnItemsList) return;
            
            returnItemsList.innerHTML = '';
            
            if (entry.items) {
                entry.items.forEach((item, index) => {
                    const remainingQuantity = item.quantity - (item.returned || 0);
                    
                    if (remainingQuantity > 0) {
                        const returnItem = document.createElement('div');
                        returnItem.className = 'return-item';
                        returnItem.innerHTML = `
                            <input type="checkbox" class="return-checkbox" id="return-${index}" onchange="toggleReturnItem(${index}, ${remainingQuantity})">
                            <div class="return-item-info">
                                <div class="return-item-name">${item.name}</div>
                                <div class="return-item-details">
                                    <span>Borrowed: ${item.quantity}</span>
                                    <span>Already returned: ${item.returned || 0}</span>
                                    <span>Remaining: ${remainingQuantity}</span>
                                </div>
                            </div>
                            <div class="return-quantity-control">
                                <button type="button" class="quantity-btn" onclick="decreaseReturnQuantity(${index})" disabled>
                                    <i class="bi bi-dash"></i>
                                </button>
                                <input type="number" class="quantity-input" id="return-quantity-${index}" value="0" min="0" max="${remainingQuantity}" readonly>
                                <button type="button" class="quantity-btn" onclick="increaseReturnQuantity(${index})" disabled>
                                    <i class="bi bi-plus"></i>
                                </button>
                            </div>
                        `;
                        returnItemsList.appendChild(returnItem);
                        
                        // Initialize return quantities
                        returnQuantities[index] = 0;
                    }
                });
            }
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('returnItemsModal'));
            modal.show();
        }

        // Toggle return item selection
        function toggleReturnItem(index, maxQuantity) {
            const checkbox = document.getElementById(`return-${index}`);
            const quantityInput = document.getElementById(`return-quantity-${index}`);
            const decreaseBtn = checkbox.parentElement.querySelector('.quantity-btn:first-of-type');
            const increaseBtn = checkbox.parentElement.querySelector('.quantity-btn:last-of-type');
            
            if (checkbox.checked) {
                returnQuantities[index] = 1;
                if (quantityInput) quantityInput.value = 1;
                if (decreaseBtn) decreaseBtn.disabled = false;
                if (increaseBtn) increaseBtn.disabled = maxQuantity <= 1;
            } else {
                returnQuantities[index] = 0;
                if (quantityInput) quantityInput.value = 0;
                if (decreaseBtn) decreaseBtn.disabled = true;
                if (increaseBtn) increaseBtn.disabled = true;
            }
        }

        // Increase return quantity
        function increaseReturnQuantity(index) {
            const entry = borrowingLog.find(e => e.id === currentReturnId);
            if (!entry || !entry.items) return;
            
            const item = entry.items[index];
            const maxQuantity = item.quantity - (item.returned || 0);
            const current = returnQuantities[index] || 0;
            
            if (current < maxQuantity) {
                returnQuantities[index] = current + 1;
                const quantityInput = document.getElementById(`return-quantity-${index}`);
                if (quantityInput) quantityInput.value = returnQuantities[index];
                
                // Update button states
                const decreaseBtn = document.querySelector(`#return-${index}`).parentElement.querySelector('.quantity-btn:first-of-type');
                const increaseBtn = document.querySelector(`#return-${index}`).parentElement.querySelector('.quantity-btn:last-of-type');
                
                if (decreaseBtn) decreaseBtn.disabled = false;
                if (increaseBtn && returnQuantities[index] >= maxQuantity) {
                    increaseBtn.disabled = true;
                }
            }
        }

        // Decrease return quantity
        function decreaseReturnQuantity(index) {
            const current = returnQuantities[index] || 0;
            
            if (current > 0) {
                returnQuantities[index] = current - 1;
                const quantityInput = document.getElementById(`return-quantity-${index}`);
                if (quantityInput) quantityInput.value = returnQuantities[index];
                
                // Update button states
                const decreaseBtn = document.querySelector(`#return-${index}`).parentElement.querySelector('.quantity-btn:first-of-type');
                const increaseBtn = document.querySelector(`#return-${index}`).parentElement.querySelector('.quantity-btn:last-of-type');
                
                if (increaseBtn) increaseBtn.disabled = false;
                if (decreaseBtn && returnQuantities[index] <= 0) {
                    decreaseBtn.disabled = true;
                }
            }
        }

        // Process return
        function processReturn() {
            const entry = borrowingLog.find(e => e.id === currentReturnId);
            if (!entry) return;
            
            // Check if any items are selected for return
            const totalReturnQuantity = Object.values(returnQuantities).reduce((sum, qty) => sum + qty, 0);
            if (totalReturnQuantity === 0) {
                showToast('error', 'No Items Selected', 'Please select at least one item to return.');
                return;
            }
            
            // Prepare updates
            const updates = {};
            const inventoryUpdates = {};
            let allItemsReturned = true;
            
            // Update borrowing log with returned quantities
            if (entry.items) {
                entry.items.forEach((item, index) => {
                    const returnQuantity = returnQuantities[index] || 0;
                    if (returnQuantity > 0) {
                        // Update returned quantity
                        updates[`borrowingLog/${currentReturnId}/items/${index}/returned`] = (item.returned || 0) + returnQuantity;
                        
                        // Update inventory
                        const itemId = Object.keys(items).find(key => {
                            return items[key] && items[key].name.toLowerCase() === item.name.toLowerCase();
                        });
                        
                        if (itemId) {
                            inventoryUpdates[`inventory/${itemId}`] = (inventory[itemId] || 0) + returnQuantity;
                        }
                    }
                    
                    // Check if all items are fully returned
                    const totalReturned = (item.returned || 0) + (returnQuantities[index] || 0);
                    if (totalReturned < item.quantity) {
                        allItemsReturned = false;
                    }
                });
            }
            
            // Update status and return date
            if (allItemsReturned) {
                updates[`borrowingLog/${currentReturnId}/status`] = 'returned';
                updates[`borrowingLog/${currentReturnId}/actualReturnDate`] = new Date().toISOString().split('T')[0];
            } else {
                updates[`borrowingLog/${currentReturnId}/status`] = 'partial';
            }
            
            // Apply updates
            if (database) {
                database.ref().update({ ...updates, ...inventoryUpdates })
                    .then(() => {
                        // Close modal
                        const modal = bootstrap.Modal.getInstance(document.getElementById('returnItemsModal'));
                        if (modal) modal.hide();
                        
                        // Show success message
                        if (allItemsReturned) {
                            showToast('success', 'All Items Returned', 'All items have been successfully returned.');
                        } else {
                            showToast('success', 'Partial Return Processed', 'Selected items have been returned. Some items are still on loan.');
                        }
                    })
                    .catch((error) => {
                        console.error("Error processing return:", error);
                        showToast('error', 'Return Error', 'Failed to process the return. Please try again.');
                    });
            }
        }

        // Admin functions
        function updateDashboardStats() {
            if (!items || !inventory || !borrowingLog) return;
            
            const totalItems = Object.keys(items).length;
            const availableItems = Object.values(inventory).reduce((sum, qty) => sum + qty, 0);
            const activeBorrows = borrowingLog.filter(entry => 
                entry.status === 'pending' || entry.status === 'overdue' || 
                entry.status === 'partial' || entry.status === 'on loan'
            ).length;
            const lowStock = Object.values(inventory).filter(qty => qty <= 3).length;
            
            const totalItemsEl = document.getElementById('totalItems');
            const availableItemsEl = document.getElementById('availableItems');
            const activeBorrowsEl = document.getElementById('activeBorrows');
            const lowStockEl = document.getElementById('lowStock');
            
            if (totalItemsEl) totalItemsEl.textContent = totalItems;
            if (availableItemsEl) availableItemsEl.textContent = availableItems;
            if (activeBorrowsEl) activeBorrowsEl.textContent = activeBorrows;
            if (lowStockEl) lowStockEl.textContent = lowStock;
        }

        function updateRecentActivity() {
            const recentActivity = document.getElementById('recentActivity');
            if (!recentActivity) return;
            
            if (!borrowingLog || borrowingLog.length === 0) {
                recentActivity.innerHTML = '<p class="text-muted">No recent activity</p>';
                return;
            }
            
            // Sort by date (newest first) and take last 5
            const recent = [...borrowingLog]
                .sort((a, b) => new Date(b.borrowDate) - new Date(a.borrowDate))
                .slice(0, 5);
            
            let html = '<div class="list-group list-group-flush">';
            
            recent.forEach(entry => {
                const statusClass = entry.status === 'returned' ? 'success' : 
                                   entry.status === 'overdue' ? 'danger' : 
                                   entry.status === 'partial' ? 'info' : 'warning';
                
                const itemsText = entry.items ? entry.items.map(item => {
                    const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                    return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                }).join(', ') : 'No items';
                
                html += `
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fw-semibold">${entry.borrowerName}</div>
                            <small class="text-muted">Borrowed: ${itemsText}</small>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-${statusClass}">${getStatusText(entry.status)}</span>
                            <div><small class="text-muted">${formatDate(entry.borrowDate)}</small></div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            recentActivity.innerHTML = html;
        }

        function renderInventory() {
            const inventoryList = document.getElementById('inventoryList');
            if (!inventoryList) return;
            
            if (!items || Object.keys(items).length === 0) {
                inventoryList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="bi bi-stack"></i>
                        </div>
                        <div class="empty-state-title">No Inventory Items</div>
                        <div class="empty-state-description">
                            Add office supplies items to start managing your inventory.
                        </div>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addItemModal">
                            <i class="bi bi-plus-circle me-2"></i>Add Items
                        </button>
                    </div>
                `;
                return;
            }
            
            // Filter items based on current filter
            let filteredItems = Object.entries(items);
            
            if (currentFilter === 'low') {
                filteredItems = filteredItems.filter(([id]) => (inventory[id] || 0) <= 3);
            } else if (currentFilter === 'medium') {
                filteredItems = filteredItems.filter(([id]) => {
                    const qty = inventory[id] || 0;
                    return qty >= 4 && qty <= 6;
                });
            } else if (currentFilter === 'high') {
                filteredItems = filteredItems.filter(([id]) => (inventory[id] || 0) > 6);
            }
            
            if (filteredItems.length === 0) {
                inventoryList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="bi bi-funnel"></i>
                        </div>
                        <div class="empty-state-title">No Items Found</div>
                        <div class="empty-state-description">
                            No items match the current filter. Try a different filter or add new items.
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            filteredItems.forEach(([id, item]) => {
                if (!item) return;
                
                const quantity = inventory[id] || 0;
                let quantityClass = 'quantity-high';
                
                if (quantity <= 3) {
                    quantityClass = 'quantity-low';
                } else if (quantity <= 6) {
                    quantityClass = 'quantity-medium';
                }
                
                html += `
                    <div class="item-card">
                        <div class="item-header">
                            <div class="item-info">
                                <div class="item-icon">
                                    <i class="bi bi-box"></i>
                                </div>
                                <div>
                                    <div class="item-name">${item.name}</div>
                                    <div class="item-quantity">
                                        <span>Current Stock:</span>
                                        <span class="quantity-badge ${quantityClass}">${quantity}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <button class="btn btn-sm btn-outline-danger me-2" onclick="updateInventoryQuantity('${id}', -1)">
                                    <i class="bi bi-dash"></i>
                                </button>
                                <span class="fw-bold mx-2">${quantity}</span>
                                <button class="btn btn-sm btn-outline-success ms-2" onclick="updateInventoryQuantity('${id}', 1)">
                                    <i class="bi bi-plus"></i>
                                </button>
                                <div class="item-actions ms-3">
                                    <button class="btn-icon edit" onclick="editItem('${id}')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn-icon delete" onclick="deleteItem('${id}')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            inventoryList.innerHTML = html;
        }

        // Filter items function
        function filterItems(filter) {
            currentFilter = filter;
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Re-render inventory with filter
            renderInventory();
        }

        function updateInventoryQuantity(itemId, change) {
            if (!inventoryRef || !items) return;
            
            const newQuantity = Math.max(0, (inventory[itemId] || 0) + change);
            
            inventoryRef.child(itemId).set(newQuantity)
                .then(() => {
                    const itemName = items[itemId] ? items[itemId].name : 'Item';
                    showToast('success', 'Inventory Updated', `${itemName} quantity updated to ${newQuantity}.`);
                })
                .catch((error) => {
                    console.error("Error updating inventory:", error);
                    showToast('error', 'Update Error', 'Failed to update inventory. Please try again.');
                });
        }

        function addNewItem() {
            if (!database || !itemsRef || !inventoryRef) {
                showToast('error', 'Not Connected', 'Please wait for the system to initialize.');
                return;
            }
            
            const name = document.getElementById('itemName').value.trim();
            const quantity = parseInt(document.getElementById('itemQuantity').value);
            
            if (!name) {
                showToast('error', 'Validation Error', 'Please fill in all fields.');
                return;
            }
            
            if (isNaN(quantity) || quantity < 0) {
                showToast('error', 'Validation Error', 'Please enter a valid quantity.');
                return;
            }
            
            // Generate ID from name (lowercase, no spaces)
            const id = name.toLowerCase().replace(/\s+/g, '');
            
            // Check if item already exists
            if (items[id]) {
                showToast('error', 'Duplicate Item', 'An item with this name already exists.');
                return;
            }
            
            // Add item to Firebase
            const updates = {};
            updates[`items/${id}`] = { name };
            updates[`inventory/${id}`] = quantity;
            
            database.ref().update(updates)
                .then(() => {
                    // Close modal and reset form
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addItemModal'));
                    if (modal) modal.hide();
                    document.getElementById('addItemForm').reset();
                    
                    showToast('success', 'Item Added', `${name} has been added successfully.`);
                })
                .catch((error) => {
                    console.error("Error adding item:", error);
                    showToast('error', 'Add Error', 'Failed to add item. Please try again.');
                });
        }

        function editItem(itemId) {
            const item = items[itemId];
            if (!item) return;
            
            const editItemId = document.getElementById('editItemId');
            const editItemName = document.getElementById('editItemName');
            
            if (editItemId) editItemId.value = itemId;
            if (editItemName) editItemName.value = item.name;
            
            // Show modal
            new bootstrap.Modal(document.getElementById('editItemModal')).show();
        }

        function updateItem() {
            if (!itemsRef) {
                showToast('error', 'Not Connected', 'Please wait for the system to initialize.');
                return;
            }
            
            const itemId = document.getElementById('editItemId').value;
            const name = document.getElementById('editItemName').value.trim();
            
            if (!name) {
                showToast('error', 'Validation Error', 'Please fill in all fields.');
                return;
            }
            
            // Update item in Firebase
            itemsRef.child(itemId).set({ name })
                .then(() => {
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('editItemModal'));
                    if (modal) modal.hide();
                    
                    showToast('success', 'Item Updated', `${name} has been updated successfully.`);
                })
                .catch((error) => {
                    console.error("Error updating item:", error);
                    showToast('error', 'Update Error', 'Failed to update item. Please try again.');
                });
        }

        function deleteItem(itemId) {
            const item = items[itemId];
            if (!item) return;
            
            if (confirm(`Are you sure you want to delete "${item.name}"? This will also remove all inventory data for this item.`)) {
                if (!database) {
                    showToast('error', 'Not Connected', 'Please wait for the system to initialize.');
                    return;
                }
                
                // Delete item and inventory from Firebase
                const updates = {};
                updates[`items/${itemId}`] = null;
                updates[`inventory/${itemId}`] = null;
                
                database.ref().update(updates)
                    .then(() => {
                        showToast('success', 'Item Deleted', `${item.name} has been deleted successfully.`);
                    })
                    .catch((error) => {
                        console.error("Error deleting item:", error);
                        showToast('error', 'Delete Error', 'Failed to delete item. Please try again.');
                    });
            }
        }

        function updateRecordsTable() {
            const tableBody = document.getElementById('recordsTableBody');
            const mobileContainer = document.getElementById('recordsMobile');
            const searchInput = document.getElementById('recordsSearch');
            
            if (!tableBody || !mobileContainer) return;
            
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            
            // Filter records
            let filteredRecords = borrowingLog.filter(entry => {
                return entry.borrowerName.toLowerCase().includes(searchTerm) || 
                       (entry.purpose && entry.purpose.toLowerCase().includes(searchTerm));
            });
            
            // Check for overdue items
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            filteredRecords = filteredRecords.map(entry => {
                const returnDate = new Date(entry.returnDate);
                returnDate.setHours(0, 0, 0, 0);
                
                if ((entry.status === 'pending' || entry.status === 'on loan') && today > returnDate) {
                    return { ...entry, status: 'overdue' };
                }
                return entry;
            });
            
            // Sort by date (newest first)
            filteredRecords.sort((a, b) => new Date(b.borrowDate) - new Date(a.borrowDate));
            
            // Check if we should show mobile view
            const isMobile = window.innerWidth <= 768;
            
            if (filteredRecords.length === 0) {
                if (isMobile) {
                    tableBody.parentElement.parentElement.style.display = 'none';
                    mobileContainer.style.display = 'block';
                    mobileContainer.innerHTML = '<div class="empty-state"><p>No records found</p></div>';
                } else {
                    tableBody.parentElement.parentElement.style.display = 'block';
                    mobileContainer.style.display = 'none';
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">No records found</td></tr>';
                }
                return;
            }
            
            if (isMobile) {
                // Hide desktop table and show mobile cards
                tableBody.parentElement.parentElement.style.display = 'none';
                mobileContainer.style.display = 'block';
                
                let html = '';
                filteredRecords.forEach(entry => {
                    let statusBadge = '';
                    if (entry.status === 'returned') {
                        statusBadge = '<span class="badge badge-returned">Returned</span>';
                    } else if (entry.status === 'overdue') {
                        statusBadge = '<span class="badge badge-overdue">Overdue</span>';
                    } else if (entry.status === 'partial') {
                        statusBadge = '<span class="badge badge-partial">Partial Return</span>';
                    } else {
                        statusBadge = '<span class="badge badge-pending">On loan</span>';
                    }
                    
                    const itemsText = entry.items ? entry.items.map(item => {
                        const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                        return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                    }).join(', ') : 'No items';
                    
                    let actionButton = '';
                    if (entry.status !== 'returned') {
                        actionButton = `<button class="btn btn-success btn-sm w-100" onclick="showReturnModal(${entry.id})">
                                            <i class="bi bi-box-arrow-in-left me-1"></i>Return Items
                                        </button>`;
                    } else {
                        actionButton = `<span class="text-muted">
                                            Returned on ${formatDate(entry.actualReturnDate)}
                                        </span>`;
                    }
                    
                    html += `
                        <div class="mobile-card">
                            <div class="mobile-card-header">ID: ${entry.id} - ${entry.borrowerName}</div>
                            <div class="mobile-card-row">
                                <div class="mobile-card-label">Items:</div>
                                <div class="mobile-card-value">${itemsText}</div>
                            </div>
                            <div class="mobile-card-row">
                                <div class="mobile-card-label">Purpose:</div>
                                <div class="mobile-card-value">${entry.purpose || 'N/A'}</div>
                            </div>
                            <div class="mobile-card-row">
                                <div class="mobile-card-label">Borrow Date:</div>
                                <div class="mobile-card-value">${formatDate(entry.borrowDate)}</div>
                            </div>
                            <div class="mobile-card-row">
                                <div class="mobile-card-label">Return Date:</div>
                                <div class="mobile-card-value">${formatDate(entry.returnDate)}</div>
                            </div>
                            <div class="mobile-card-row">
                                <div class="mobile-card-label">Status:</div>
                                <div class="mobile-card-value">${statusBadge}</div>
                            </div>
                            <div class="mobile-card-row">
                                <div class="mobile-card-label">Action:</div>
                                <div class="mobile-card-value">${actionButton}</div>
                            </div>
                        </div>
                    `;
                });
                
                mobileContainer.innerHTML = html;
            } else {
                // Show desktop table and hide mobile cards
                tableBody.parentElement.parentElement.style.display = 'block';
                mobileContainer.style.display = 'none';
                
                let html = '';
                
                filteredRecords.forEach(entry => {
                    let statusBadge = '';
                    if (entry.status === 'returned') {
                        statusBadge = '<span class="badge badge-returned">Returned</span>';
                    } else if (entry.status === 'overdue') {
                        statusBadge = '<span class="badge badge-overdue">Overdue</span>';
                    } else if (entry.status === 'partial') {
                        statusBadge = '<span class="badge badge-partial">Partial Return</span>';
                    } else {
                        statusBadge = '<span class="badge badge-pending">On loan</span>';
                    }
                    
                    const itemsText = entry.items ? entry.items.map(item => {
                        const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                        return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                    }).join(', ') : 'No items';
                    
                    let actionButton = '';
                    if (entry.status !== 'returned') {
                        actionButton = `<button class="btn btn-success btn-sm" onclick="showReturnModal(${entry.id})">
                                            <i class="bi bi-box-arrow-in-left me-1"></i>Return Items
                                        </button>`;
                    } else {
                        actionButton = `<span class="text-muted">
                                            Returned on ${formatDate(entry.actualReturnDate)}
                                        </span>`;
                    }
                    
                    html += `
                        <tr>
                            <td>${entry.id}</td>
                            <td>${entry.borrowerName}</td>
                            <td>${itemsText}</td>
                            <td>${entry.purpose || 'N/A'}</td>
                            <td>${formatDate(entry.borrowDate)}</td>
                            <td>${formatDate(entry.returnDate)}</td>
                            <td>${statusBadge}</td>
                            <td>${actionButton}</td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            }
        }

        // Status section functions
        function showStatusTab(status) {
            // Hide all status content
            document.querySelectorAll('.status-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.status-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected content
            const statusContent = document.getElementById(status + 'Items');
            if (statusContent) {
                statusContent.classList.add('active');
            }
            
            // Add active class to clicked tab
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }

        function updateStatusCounts() {
            if (!borrowingLog) return;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let pendingCount = 0;
            let overdueCount = 0;
            let partialCount = 0;
            let returnedCount = 0;
            
            borrowingLog.forEach(entry => {
                if (entry.status === 'returned') {
                    returnedCount++;
                } else if (entry.status === 'partial') {
                    partialCount++;
                } else {
                    const returnDate = new Date(entry.returnDate);
                    returnDate.setHours(0, 0, 0, 0);
                    
                    if (today > returnDate) {
                        overdueCount++;
                    } else {
                        pendingCount++;
                    }
                }
            });
            
            const pendingCountEl = document.getElementById('pendingCount');
            const overdueCountEl = document.getElementById('overdueCount');
            const partialCountEl = document.getElementById('partialCount');
            const returnedCountEl = document.getElementById('returnedCount');
            
            if (pendingCountEl) pendingCountEl.textContent = pendingCount;
            if (overdueCountEl) overdueCountEl.textContent = overdueCount;
            if (partialCountEl) partialCountEl.textContent = partialCount;
            if (returnedCountEl) returnedCountEl.textContent = returnedCount;
        }

        // Update status lists with mobile support
        function updateStatusLists() {
            if (!borrowingLog) return;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Check if we should show mobile view
            const isMobile = window.innerWidth <= 768;
            
            // Update pending items
            const pendingList = document.getElementById('pendingItemsList');
            if (pendingList) {
                const pendingItems = borrowingLog.filter(entry => {
                    if (entry.status === 'returned' || entry.status === 'partial') return false;
                    
                    const returnDate = new Date(entry.returnDate);
                    returnDate.setHours(0, 0, 0, 0);
                    
                    return today <= returnDate;
                }).sort((a, b) => new Date(a.returnDate) - new Date(b.returnDate));
                
                if (pendingItems.length === 0) {
                    pendingList.innerHTML = '<p class="text-muted">No items on loan</p>';
                } else {
                    if (isMobile) {
                        // Mobile card view
                        let html = '';
                        pendingItems.forEach(entry => {
                            const itemsText = entry.items ? entry.items.map(item => {
                                const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                                return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                            }).join(', ') : 'No items';
                            
                            html += `
                                <div class="mobile-card">
                                    <div class="mobile-card-header">${entry.borrowerName}</div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Items:</div>
                                        <div class="mobile-card-value">${itemsText}</div>
                                    </div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Due Date:</div>
                                        <div class="mobile-card-value">${formatDate(entry.returnDate)}</div>
                                    </div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Action:</div>
                                        <div class="mobile-card-value">
                                            <button class="btn btn-success btn-sm w-100" onclick="showReturnModal(${entry.id})">
                                                <i class="bi bi-box-arrow-in-left me-1"></i>Return Items
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        pendingList.innerHTML = html;
                    } else {
                        // Desktop table view
                        let html = '<div class="table-responsive"><table class="table"><thead><tr><th>Borrower</th><th>Items</th><th>Due Date</th><th>Action</th></tr></thead><tbody>';
                        pendingItems.forEach(entry => {
                            const itemsText = entry.items ? entry.items.map(item => {
                                const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                                return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                            }).join(', ') : 'No items';
                            
                            html += `
                                <tr>
                                    <td>${entry.borrowerName}</td>
                                    <td>${itemsText}</td>
                                    <td>${formatDate(entry.returnDate)}</td>
                                    <td>
                                        <button class="btn btn-success btn-sm" onclick="showReturnModal(${entry.id})">
                                            <i class="bi bi-box-arrow-in-left me-1"></i>Return Items
                                        </button>
                                    </td>
                                </tr>
                            `;
                        });
                        html += '</tbody></table></div>';
                        pendingList.innerHTML = html;
                    }
                }
            }
            
            // Update overdue items
            const overdueList = document.getElementById('overdueItemsList');
            if (overdueList) {
                const overdueItems = borrowingLog.filter(entry => {
                    if (entry.status === 'returned' || entry.status === 'partial') return false;
                    
                    const returnDate = new Date(entry.returnDate);
                    returnDate.setHours(0, 0, 0, 0);
                    
                    return today > returnDate;
                }).sort((a, b) => new Date(a.returnDate) - new Date(b.returnDate));
                
                if (overdueItems.length === 0) {
                    overdueList.innerHTML = '<p class="text-muted">No overdue items</p>';
                } else {
                    if (isMobile) {
                        // Mobile card view
                        let html = '';
                        overdueItems.forEach(entry => {
                            const returnDate = new Date(entry.returnDate);
                            returnDate.setHours(0, 0, 0, 0);
                            
                            const daysOverdue = Math.floor((today - returnDate) / (1000 * 60 * 60 * 24));
                            const itemsText = entry.items ? entry.items.map(item => {
                                const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                                return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                            }).join(', ') : 'No items';
                            
                            html += `
                                <div class="mobile-card">
                                    <div class="mobile-card-header">${entry.borrowerName}</div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Items:</div>
                                        <div class="mobile-card-value">${itemsText}</div>
                                    </div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Due Date:</div>
                                        <div class="mobile-card-value">${formatDate(entry.returnDate)}</div>
                                    </div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Days Overdue:</div>
                                        <div class="mobile-card-value">
                                            <span class="badge bg-danger">${daysOverdue} days</span>
                                        </div>
                                    </div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Action:</div>
                                        <div class="mobile-card-value">
                                            <button class="btn btn-success btn-sm w-100" onclick="showReturnModal(${entry.id})">
                                                <i class="bi bi-box-arrow-in-left me-1"></i>Return Items
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        overdueList.innerHTML = html;
                    } else {
                        // Desktop table view
                        let html = '<div class="table-responsive"><table class="table"><thead><tr><th>Borrower</th><th>Items</th><th>Due Date</th><th>Days Overdue</th><th>Action</th></tr></thead><tbody>';
                        overdueItems.forEach(entry => {
                            const returnDate = new Date(entry.returnDate);
                            returnDate.setHours(0, 0, 0, 0);
                            
                            const daysOverdue = Math.floor((today - returnDate) / (1000 * 60 * 60 * 24));
                            const itemsText = entry.items ? entry.items.map(item => {
                                const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                                return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                            }).join(', ') : 'No items';
                            
                            html += `
                                <tr>
                                    <td>${entry.borrowerName}</td>
                                    <td>${itemsText}</td>
                                    <td>${formatDate(entry.returnDate)}</td>
                                    <td><span class="badge bg-danger">${daysOverdue} days</span></td>
                                    <td>
                                        <button class="btn btn-success btn-sm" onclick="showReturnModal(${entry.id})">
                                            <i class="bi bi-box-arrow-in-left me-1"></i>Return Items
                                        </button>
                                    </td>
                                </tr>
                            `;
                        });
                        html += '</tbody></table></div>';
                        overdueList.innerHTML = html;
                    }
                }
            }
            
            // Update partial return items
            const partialList = document.getElementById('partialItemsList');
            if (partialList) {
                const partialItems = borrowingLog.filter(entry => entry.status === 'partial')
                    .sort((a, b) => new Date(b.borrowDate) - new Date(a.borrowDate));
                
                if (partialItems.length === 0) {
                    partialList.innerHTML = '<p class="text-muted">No partial returns</p>';
                } else {
                    if (isMobile) {
                        // Mobile card view
                        let html = '';
                        partialItems.forEach(entry => {
                            const itemsText = entry.items ? entry.items.map(item => {
                                const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                                return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                            }).join(', ') : 'No items';
                            
                            html += `
                                <div class="mobile-card">
                                    <div class="mobile-card-header">${entry.borrowerName}</div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Items:</div>
                                        <div class="mobile-card-value">${itemsText}</div>
                                    </div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Borrow Date:</div>
                                        <div class="mobile-card-value">${formatDate(entry.borrowDate)}</div>
                                    </div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Action:</div>
                                        <div class="mobile-card-value">
                                            <button class="btn btn-success btn-sm w-100" onclick="showReturnModal(${entry.id})">
                                                <i class="bi bi-box-arrow-in-left me-1"></i>Return More
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        partialList.innerHTML = html;
                    } else {
                        // Desktop table view
                        let html = '<div class="table-responsive"><table class="table"><thead><tr><th>Borrower</th><th>Items</th><th>Borrow Date</th><th>Action</th></tr></thead><tbody>';
                        partialItems.forEach(entry => {
                            const itemsText = entry.items ? entry.items.map(item => {
                                const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                                return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                            }).join(', ') : 'No items';
                            
                            html += `
                                <tr>
                                    <td>${entry.borrowerName}</td>
                                    <td>${itemsText}</td>
                                    <td>${formatDate(entry.borrowDate)}</td>
                                    <td>
                                        <button class="btn btn-success btn-sm" onclick="showReturnModal(${entry.id})">
                                            <i class="bi bi-box-arrow-in-left me-1"></i>Return More
                                        </button>
                                    </td>
                                </tr>
                            `;
                        });
                        html += '</tbody></table></div>';
                        partialList.innerHTML = html;
                    }
                }
            }
            
            // Update returned items
            const returnedList = document.getElementById('returnedItemsList');
            if (returnedList) {
                const returnedItems = borrowingLog.filter(entry => entry.status === 'returned')
                    .sort((a, b) => new Date(b.actualReturnDate) - new Date(a.actualReturnDate))
                    .slice(0, 10); // Show last 10 returned items
                
                if (returnedItems.length === 0) {
                    returnedList.innerHTML = '<p class="text-muted">No returned items</p>';
                } else {
                    if (isMobile) {
                        // Mobile card view
                        let html = '';
                        returnedItems.forEach(entry => {
                            const itemsText = entry.items ? entry.items.map(item => {
                                const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                                return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                            }).join(', ') : 'No items';
                            
                            html += `
                                <div class="mobile-card">
                                    <div class="mobile-card-header">${entry.borrowerName}</div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Items:</div>
                                        <div class="mobile-card-value">${itemsText}</div>
                                    </div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Borrow Date:</div>
                                        <div class="mobile-card-value">${formatDate(entry.borrowDate)}</div>
                                    </div>
                                    <div class="mobile-card-row">
                                        <div class="mobile-card-label">Return Date:</div>
                                        <div class="mobile-card-value">${formatDate(entry.actualReturnDate)}</div>
                                    </div>
                                </div>
                            `;
                        });
                        returnedList.innerHTML = html;
                    } else {
                        // Desktop table view
                        let html = '<div class="table-responsive"><table class="table"><thead><tr><th>Borrower</th><th>Items</th><th>Borrow Date</th><th>Return Date</th></tr></thead><tbody>';
                        returnedItems.forEach(entry => {
                            const itemsText = entry.items ? entry.items.map(item => {
                                const returnedText = item.returned > 0 ? ` (${item.returned}/${item.quantity} returned)` : '';
                                return `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}${returnedText}`;
                            }).join(', ') : 'No items';
                            
                            html += `
                                <tr>
                                    <td>${entry.borrowerName}</td>
                                    <td>${itemsText}</td>
                                    <td>${formatDate(entry.borrowDate)}</td>
                                    <td>${formatDate(entry.actualReturnDate)}</td>
                                </tr>
                            `;
                        });
                        html += '</tbody></table></div>';
                        returnedList.innerHTML = html;
                    }
                }
            }
        }

        // Search functionality
        const recordsSearch = document.getElementById('recordsSearch');
        if (recordsSearch) {
            recordsSearch.addEventListener('input', updateRecordsTable);
        }

        // Update connection status
        function updateConnectionStatus(isConnected) {
            const statusElement = document.getElementById('connectionStatus');
            if (!statusElement) return;
            
            if (isConnected) {
                statusElement.className = 'connection-status connected';
                statusElement.innerHTML = '<i class="bi bi-wifi"></i><span>Connected to Firebase</span>';
            } else {
                statusElement.className = 'connection-status disconnected';
                statusElement.innerHTML = '<i class="bi bi-wifi-off"></i><span>Disconnected</span>';
            }
        }

        // Show toast notification
        function showToast(type, title, message) {
            const toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            toast.className = `custom-toast toast-${type}`;
            
            const iconClass = type === 'success' ? 'bi-check-circle-fill' : 'bi-exclamation-circle-fill';
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="bi ${iconClass}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <i class="bi bi-x"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        // Debounce function for search
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Debounced search function
        const debouncedSearch = debounce(updateRecordsTable, 300);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Firebase when page loads
            initializeFirebase();
            
            // Check if mobile view on load
            updateRecentBorrowingTable();
            updateRecordsTable();
            updateStatusLists();
            
            // Add resize event listener to handle orientation changes
            window.addEventListener('resize', function() {
                updateRecentBorrowingTable();
                updateRecordsTable();
                updateStatusLists();
            });
            
            // Add debounced search listener
            const recordsSearch = document.getElementById('recordsSearch');
            if (recordsSearch) {
                recordsSearch.addEventListener('input', debouncedSearch);
            }
        });
    </script>
</body>
</html>
